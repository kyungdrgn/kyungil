<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖Dev_Docs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #121212; /* 다크모드 배경색 */
            color: #e0e0e0; /* 텍스트 색상 */
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin-bottom: 10px;
        }

        a {
            text-decoration: none;
            color: #bb86fc; /* 링크 색상 */
        }

        a:hover {
            text-decoration: underline;
            color: #7c4dff; /* 호버 시 색상 */
        }
    </style>
</head>
<body>
    <h1>🤖Dev_Docs</h1>
    <ul id="doc-list">
        <li>문서 목록을 불러오는 중...</li>
    </ul>

    <script>
        const owner = 'kyungdrgn';
        const repo = 'kyungil';
        const docPath = 'docs'; // 문서가 있는 디렉토리 경로

        async function fetchDocs() {
            const docList = document.getElementById('doc-list');
            docList.innerHTML = ''; // 기존 목록 초기화

            try {
                // 1. GitHub API를 사용하여 /docs 디렉토리의 파일 목록 가져오기
                const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${docPath}`;
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`GitHub API Error: ${response.status} ${response.statusText}`);
                }
                const files = await response.json();

                // HTML 파일만 필터링
                const htmlFiles = files.filter(file => file.type === 'file' && file.name.endsWith('.html'));

                if (htmlFiles.length === 0) {
                    docList.innerHTML = '<li>문서가 없습니다.</li>';
                    return;
                }

                // 각 HTML 파일의 제목 가져오기
                for (const file of htmlFiles) {
                    const docUrl = `https://${owner}.github.io/${repo}/${docPath}/${file.name}`; // GitHub Pages URL
                    
                    try {
                        const docResponse = await fetch(docUrl);
                        if (!docResponse.ok) {
                            console.error(`Failed to fetch document: ${docUrl}, Status: ${docResponse.status}`);
                            continue; // 다음 파일로 넘어감
                        }
                        const docText = await docResponse.text();
                        
                        // DOMParser를 사용하여 HTML 파싱 및 title 태그 추출
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(docText, 'text/html');
                        const titleElement = doc.querySelector('title');
                        const title = titleElement ? titleElement.textContent : file.name.replace('.html', ''); // title이 없으면 파일 이름 사용

                        const listItem = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = docUrl;
                        link.textContent = title;
                        listItem.appendChild(link);
                        docList.appendChild(listItem);

                    } catch (docFetchError) {
                        console.error(`Error fetching or parsing document ${file.name}:`, docFetchError);
                        const listItem = document.createElement('li');
                        listItem.textContent = `${file.name} (불러오기 실패)`;
                        docList.appendChild(listItem);
                    }
                }
            } catch (error) {
                console.error('문서 목록을 불러오는 중 오류 발생:', error);
                docList.innerHTML = '<li>문서 목록을 불러올 수 없습니다. 오류를 콘솔에서 확인하세요.</li>';
            }
        }

        // 페이지 로드 시 문서 목록 가져오기
        document.addEventListener('DOMContentLoaded', fetchDocs);
    </script>
</body>
</html>